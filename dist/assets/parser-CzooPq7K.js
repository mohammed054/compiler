import{tokenize as a}from"./tokenizer-44gyebTE.js";class n{tokens;pos=0;constructor(e){this.tokens=e}peek(){return this.tokens[this.pos]}advance(){return this.tokens[this.pos++]}atEnd(){return this.peek().type==="EOF"}parseProgram(){const e=[],t=[];for(;!this.atEnd();)try{const r=this.parseExpr();r&&e.push(r)}catch(r){const s=this.peek();t.push({message:r.message,line:s.line,column:s.column}),this.advance()}return{body:e,errors:t}}parseExpr(){const e=this.peek();if(e.type==="EOF"||e.type==="COMMENT")return this.advance(),null;if(e.type==="RPAREN"||e.type==="RBRACKET"||e.type==="RBRACE")throw new Error(`Unexpected ${e.type}`);switch(e.type){case"LPAREN":return this.parseList();case"LBRACKET":return this.parseVector();case"LBRACE":return this.parseMap();case"QUOTE":return this.parseQuote();case"QUASIQUOTE":return this.parseQuasiquote();case"UNQUOTE":return this.parseUnquote();case"NUMBER":return this.advance(),{type:"Literal",value:parseFloat(e.value)};case"STRING":return this.advance(),{type:"Literal",value:e.value};case"TRUE":return this.advance(),{type:"Literal",value:!0};case"FALSE":return this.advance(),{type:"Literal",value:!1};case"NIL":return this.advance(),{type:"Literal",value:null};case"KEYWORD":return this.advance(),{type:"Literal",value:e.value};case"SYMBOL":return this.advance(),{type:"Symbol",value:e.value};default:throw new Error(`Unexpected token: ${e.type}`)}}parseList(){this.expect("LPAREN");const e=[];for(;this.peek().type!=="RPAREN"&&this.peek().type!=="EOF";){const t=this.parseExpr();t&&e.push(t)}return this.expect("RPAREN"),{type:"List",elements:e}}parseVector(){this.expect("LBRACKET");const e=[];for(;this.peek().type!=="RBRACKET"&&this.peek().type!=="EOF";){const t=this.parseExpr();t&&e.push(t)}return this.expect("RBRACKET"),{type:"Vector",elements:e}}parseMap(){this.expect("LBRACE");const e=[];for(;this.peek().type!=="RBRACE"&&this.peek().type!=="EOF";){const t=this.parseExpr();if(!t)throw new Error("Expected key in map");const r=this.parseExpr();if(!r)throw new Error("Expected value in map");e.push({key:t,value:r})}return this.expect("RBRACE"),{type:"Map",pairs:e}}parseQuote(){return this.expect("QUOTE"),{type:"Quote",expr:this.parseExpr()}}parseQuasiquote(){return this.expect("QUASIQUOTE"),{type:"Quasiquote",expr:this.parseExpr()}}parseUnquote(){return this.expect("UNQUOTE"),{type:"Unquote",expr:this.parseExpr()}}expect(e){const t=this.peek();if(t.type!==e)throw new Error(`Expected ${e} but got ${t.type} at line ${t.line}`);return this.advance()}}function o(p){const e=a(p),t=new n(e),{body:r,errors:s}=t.parseProgram();return{cst:{type:"Program",body:r},errors:s}}export{o as parseProgram};
